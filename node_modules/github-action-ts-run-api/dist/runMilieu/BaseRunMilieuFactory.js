"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseRunMilieuFactory = void 0;
const BaseRunMilieu_1 = require("./BaseRunMilieu");
const RunMilieuFs_1 = require("./RunMilieuFs");
class BaseRunMilieuFactory {
    constructor(componentsFactory) {
        this.componentsFactory = componentsFactory;
    }
    createMilieu(options) {
        const runnerFs = RunMilieuFs_1.RunMilieuFs.safePrepare((setFiles, setDirs) => {
            setDirs(this.componentsFactory.prepareRunnerDirs());
            setFiles(this.componentsFactory.prepareFiles());
        });
        try {
            const env = this.componentsFactory.prepareEnv(runnerFs.files, runnerFs.dirs);
            return new BaseRunMilieu_1.BaseRunMilieu(runnerFs.files, runnerFs.dirs, env.data, options.fakeFsOptions.data);
        }
        catch (err) {
            runnerFs.cleanUp();
            throw err;
        }
    }
}
exports.BaseRunMilieuFactory = BaseRunMilieuFactory;
//# sourceMappingURL=BaseRunMilieuFactory.js.map