"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DockerRunMilieuFactory = void 0;
const RunMilieuFs_1 = require("../../../runMilieu/RunMilieuFs");
const DockerRunMilieu_1 = require("./DockerRunMilieu");
class DockerRunMilieuFactory {
    constructor(componentsFactory) {
        this.componentsFactory = componentsFactory;
    }
    createMilieu(options) {
        const runnerFs = RunMilieuFs_1.RunMilieuFs.safePrepare((setFiles, setDirs) => {
            const dirs = setDirs(this.componentsFactory.prepareRunnerDirs());
            setFiles(this.componentsFactory.prepareFiles(dirs.data.fileCommands.dirPath, dirs.data.githubWorkflow.dirPath));
        });
        try {
            const env = this.componentsFactory.prepareEnv(runnerFs.files, runnerFs.dirs);
            return new DockerRunMilieu_1.DockerRunMilieu(runnerFs.files, runnerFs.dirs, env.data, options.fakeFsOptions.data, this.componentsFactory.getVolumes(runnerFs.dirs));
        }
        catch (err) {
            runnerFs.cleanUp();
            throw err;
        }
    }
}
exports.DockerRunMilieuFactory = DockerRunMilieuFactory;
//# sourceMappingURL=DockerRunMilieuFactory.js.map